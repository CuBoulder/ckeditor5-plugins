!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CKEditor5=t():(e.CKEditor5=e.CKEditor5||{},e.CKEditor5.box=t())}(self,(()=>(()=>{var e={"ckeditor5/src/core.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/core.js")},"ckeditor5/src/ui.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/ui.js")},"ckeditor5/src/utils.js":(e,t,i)=>{e.exports=i("dll-reference CKEditor5.dll")("./src/utils.js")},"dll-reference CKEditor5.dll":e=>{"use strict";e.exports=CKEditor5.dll}},t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s={};return(()=>{"use strict";i.d(s,{default:()=>b});var e=i("ckeditor5/src/core.js");function t(e,t,i,s){return s.createRange(o(e,t,i,!0,s),o(e,t,i,!1,s))}function o(e,t,i,s,o){let r=e.textNode||(s?e.nodeBefore:e.nodeAfter),n=null;for(;r&&r.getAttribute(t)==i;)n=r,r=s?r.previousSibling:r.nextSibling;return n?o.createPositionAt(n,s?"before":"after"):e}function r(e){return Array.from(e.getItems()).reduce(((e,t)=>t.is("text")||t.is("textProxy")?e+t.data:e),"")}var n=i("ckeditor5/src/utils.js");class l extends e.Command{refresh(){const e=this.editor.model,i=e.document.selection,s=i.getFirstRange();if(s.isCollapsed)if(i.hasAttribute("box")){const s=i.getAttribute("ucb-box"),o=t(i.getFirstPosition(),"ucb-box",s,e);this.value={abbr:r(o),title:s,range:o}}else this.value=null;else if(i.hasAttribute("ucb-box")){const o=i.getAttribute("ucb-box");t(i.getFirstPosition(),"ucb-box",o,e).containsRange(s,!0)?this.value={abbr:r(s),title:o,range:s}:this.value=null}else this.value=null;this.isEnabled=e.schema.checkAttributeInSelection(i,"ucb-box")}execute({abbr:e,title:t}){const i=this.editor.model,s=i.document.selection;i.change((o=>{if(s.isCollapsed){if(this.value){const{end:s}=i.insertContent(o.createText(e,{tooltip:t}),this.value.range);o.setSelection(s)}else if(""!==e){const r=s.getFirstPosition(),l=(0,n.toMap)(s.getAttributes());l.set("ucb-box",t);const{end:c}=i.insertContent(o.createText(e,l),r);o.setSelection(c)}o.removeSelectionAttribute("ucb-box")}else{const e=i.schema.getValidRanges(s.getRanges(),"ucb-box");for(const i of e)o.setAttribute("ucb-box",t,i)}}))}}class c extends e.Plugin{init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("addBox",new l(this.editor))}_defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:["ucb-box"]})}_defineConverters(){const e=this.editor.conversion;e.for("downcast").attributeToElement({model:"ucb-box",view:(e,t)=>{const{writer:i}=t;return i.createAttributeElement("div",{title:e})}}),e.for("upcast").elementToAttribute({view:{name:"div",attributes:["title"]},model:{key:"ucb-box",value:e=>e.getAttribute("title")}})}}var a=i("ckeditor5/src/ui.js");class u extends a.View{constructor(t){super(t),this.focusTracker=new n.FocusTracker,this.keystrokes=new n.KeystrokeHandler,this.abbrInputView=this._createInput("Add Box"),this.titleInputView=this._createInput("Add Title"),this.saveButtonView=this._createButton("Save",e.icons.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton("Cancel",e.icons.cancel,"ck-button-cancel"),this.cancelButtonView.delegate("execute").to(this,"cancel"),this.childViews=this.createCollection([this.abbrInputView,this.titleInputView,this.saveButtonView,this.cancelButtonView]),this._focusCycler=new a.FocusCycler({focusables:this.childViews,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-box-form"],tabindex:"-1"},children:this.childViews})}render(){super.render(),(0,a.submitHandler)({view:this}),this.childViews._items.forEach((e=>{this.focusTracker.add(e.element)})),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.abbrInputView.isEnabled?this.abbrInputView.focus():this.titleInputView.focus()}_createInput(e){const t=new a.LabeledFieldView(this.locale,a.createLabeledInputText);return t.label=e,t}_createButton(e,t,i){const s=new a.ButtonView;return s.set({label:e,icon:t,tooltip:!0,class:i}),s}}class d extends e.Plugin{static get requires(){return[a.ContextualBalloon]}init(){const e=this.editor;this._balloon=this.editor.plugins.get(a.ContextualBalloon),this.formView=this._createFormView(),e.ui.componentFactory.add("box",(()=>{const e=new a.ButtonView;return e.label="Box",e.icon='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\'>\n<svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" xmlns="http://www.w3.org/2000/svg">\n    <g transform="matrix(1.1233 0 0 .9803 -35.912 -4.5425)">\n        <path d="m487.77 134.04c0-31.458-22.288-56.997-49.741-56.997h-356.32c-27.453 0-49.742 25.539-49.742 56.997v263.48c0 31.458 22.289 56.997 49.742 56.997h356.32c27.453 0 49.741-25.539 49.741-56.997v-263.48zm-27.82 0v263.48c0 13.864-9.822 25.119-21.921 25.119h-356.32c-12.099 0-21.922-11.255-21.922-25.119v-263.48c0-13.864 9.823-25.119 21.922-25.119h356.32c12.099 0 21.921 11.255 21.921 25.119z"/>\n    </g>\n</svg>\n',e.tooltip=!0,e.withText=!1,this.listenTo(e,"execute",(()=>{this._showUI()})),e}))}_createFormView(){const e=this.editor,t=new u(e.locale);return this.listenTo(t,"submit",(()=>{const i={abbr:t.abbrInputView.fieldView.element.value,title:t.titleInputView.fieldView.element.value};e.execute("addBox",i),this._hideUI()})),this.listenTo(t,"cancel",(()=>{this._hideUI()})),(0,a.clickOutsideHandler)({emitter:t,activator:()=>this._balloon.visibleView===t,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()}),t}_showUI(){const e=this.editor.model.document.selection,t=this.editor.commands.get("addBox").value;if(this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.abbrInputView.isEnabled=e.getFirstRange().isCollapsed,t)this.formView.abbrInputView.fieldView.value=t.abbr,this.formView.titleInputView.fieldView.value=t.title;else{const t=r(e.getFirstRange());this.formView.abbrInputView.fieldView.value=t,this.formView.titleInputView.fieldView.value=""}this.formView.focus()}_hideUI(){this.formView.abbrInputView.fieldView.value="",this.formView.titleInputView.fieldView.value="",this.formView.element.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus()}_getBalloonPositionData(){const e=this.editor.editing.view,t=e.document;let i=null;return i=()=>e.domConverter.viewRangeToDom(t.selection.getFirstRange()),{target:i}}}class h extends e.Plugin{static get requires(){return[c,d]}}const b={Box:h}})(),s=s.default})()));